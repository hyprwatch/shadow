# Ubuntu 24.04 LTS (Noble Numbat)
# Requires: docker build -t shadow-builder -f testing/Containerfile.builder .

FROM shadow-builder AS builder

FROM ubuntu:24.04
LABEL org.opencontainers.image.description="Hyprwatch Shadow Agent - Ubuntu 24.04"

RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

COPY --from=builder --chown=root:root /shadow /usr/local/bin/shadow
COPY --from=builder --chown=root:root /osqueryd /usr/local/bin/osqueryd
RUN chmod 755 /usr/local/bin/shadow /usr/local/bin/osqueryd

RUN mkdir -p /var/lib/shadow

ENV SHADOW_DATA_DIR=/var/lib/shadow

ENTRYPOINT ["/usr/local/bin/shadow", "--osqueryd-path", "/usr/local/bin/osqueryd"]
